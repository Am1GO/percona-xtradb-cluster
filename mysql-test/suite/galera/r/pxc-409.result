DROP TABLE IF EXISTS `t`;
CREATE TABLE `t` (
`f1` int(10) unsigned NOT NULL,
PRIMARY KEY (`f1`)
) ENGINE=InnoDB;
DROP TRIGGER IF EXISTS t_insert_trig;
INSERT INTO t VALUES (1), (2), (3), (4), (5), (6), (7), (8), (9), (10);
CREATE TRIGGER t_insert_trig AFTER INSERT ON t
FOR EACH ROW
BEGIN
DECLARE EXIT HANDLER FOR SQLEXCEPTION
BEGIN
ROLLBACK TO savepoint_1;
# If the bug is not fixed then debug build will crash here with assertion.
END;
SAVEPOINT savepoint_1;
INSERT INTO dummy VALUES (1);
END |
INSERT INTO t VALUES (11), (12), (13), (14), (15), (16), (17), (18), (19), (20);
INSERT INTO t VALUES (21), (22), (23), (24), (25), (26), (27), (28), (29), (30);
SELECT COUNT(*) = 30 FROM t;
COUNT(*) = 30
0
DROP TABLE `t`;
include/show_binlog_events.inc
Log_name	Pos	Event_type	Server_id	End_log_pos	Info
mysqld-bin.000001	#	Query	#	#	use `test`; DROP TABLE IF EXISTS `t` /* generated by server */
mysqld-bin.000001	#	Query	#	#	use `test`; CREATE TABLE `t` (
`f1` int(10) unsigned NOT NULL,
PRIMARY KEY (`f1`)
) ENGINE=InnoDB
mysqld-bin.000001	#	Query	#	#	use `test`; DROP TRIGGER IF EXISTS t_insert_trig
mysqld-bin.000001	#	Query	#	#	BEGIN
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: # flags: STMT_END_F
mysqld-bin.000001	#	Xid	#	#	COMMIT /* XID */
mysqld-bin.000001	#	Query	#	#	use `test`; CREATE DEFINER=`root`@`localhost` TRIGGER t_insert_trig AFTER INSERT ON t
FOR EACH ROW
BEGIN
DECLARE EXIT HANDLER FOR SQLEXCEPTION
BEGIN
ROLLBACK TO savepoint_1;
# If the bug is not fixed then debug build will crash here with assertion.
END;
SAVEPOINT savepoint_1;
INSERT INTO dummy VALUES (1);
END
mysqld-bin.000001	#	Query	#	#	BEGIN
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: #
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: #
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: #
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: #
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: #
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: #
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: #
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: #
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: #
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: #
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Xid	#	#	COMMIT /* XID */
mysqld-bin.000001	#	Write_rows	#	#	table_id: #
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: #
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: #
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: #
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: #
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: #
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: #
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: #
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: #
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: #
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Xid	#	#	COMMIT /* XID */
mysqld-bin.000001	#	Query	#	#	use `test`; DROP TABLE `t` /* generated by server */
include/show_binlog_events.inc
Log_name	Pos	Event_type	Server_id	End_log_pos	Info
mysqld-bin.000001	#	Query	#	#	use `test`; DROP TABLE IF EXISTS `t` /* generated by server */
mysqld-bin.000001	#	Query	#	#	use `test`; CREATE TABLE `t` (
`f1` int(10) unsigned NOT NULL,
PRIMARY KEY (`f1`)
) ENGINE=InnoDB
mysqld-bin.000001	#	Query	#	#	use `test`; DROP TRIGGER IF EXISTS t_insert_trig
mysqld-bin.000001	#	Query	#	#	BEGIN
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: # flags: STMT_END_F
mysqld-bin.000001	#	Xid	#	#	COMMIT /* XID */
mysqld-bin.000001	#	Query	#	#	use `test`; CREATE DEFINER=`root`@`localhost` TRIGGER t_insert_trig AFTER INSERT ON t
FOR EACH ROW
BEGIN
DECLARE EXIT HANDLER FOR SQLEXCEPTION
BEGIN
ROLLBACK TO savepoint_1;
# If the bug is not fixed then debug build will crash here with assertion.
END;
SAVEPOINT savepoint_1;
INSERT INTO dummy VALUES (1);
END
mysqld-bin.000001	#	Query	#	#	BEGIN
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: # flags: STMT_END_F
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: # flags: STMT_END_F
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: # flags: STMT_END_F
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: # flags: STMT_END_F
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: # flags: STMT_END_F
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: # flags: STMT_END_F
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: # flags: STMT_END_F
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: # flags: STMT_END_F
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: # flags: STMT_END_F
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: # flags: STMT_END_F
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Xid	#	#	COMMIT /* XID */
mysqld-bin.000001	#	Query	#	#	BEGIN
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: # flags: STMT_END_F
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: # flags: STMT_END_F
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: # flags: STMT_END_F
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: # flags: STMT_END_F
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: # flags: STMT_END_F
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: # flags: STMT_END_F
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: # flags: STMT_END_F
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: # flags: STMT_END_F
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Table_map	#	#	table_id: # (test.t)
mysqld-bin.000001	#	Write_rows	#	#	table_id: # flags: STMT_END_F
mysqld-bin.000001	#	Query	#	#	SAVEPOINT `savepoint_1`
mysqld-bin.000001	#	Xid	#	#	COMMIT /* XID */
mysqld-bin.000001	#	Query	#	#	use `test`; DROP TABLE `t` /* generated by server */
